## rCore-Lab-2 物理内存管理

> 赵成钢 计75班 2017011362

#### 要求一：完成环境搭建并编译运行4章
因为我已经提前写了一段时间了，所以我个人根据教程完成了一个版本（参见：https://github.com/LyricZhao/rCore-OS），其中我根据自己的理解修改了很多结构和命名（其实本质一样）。但是为了完成Lab的方便，我在这里直接根据`rCore_tutorial`的`master`继续开发，没有使用我自己的版本。

#### 要求二：在无法提前知道物理内存范围的情况下，如何让OS获取？

- 之前在《30天自制操作系统》一书中了解到，可以通过一个循环（比如一次跳0x1000个地址）不断写入物理内存一个随机的数，然后对这个地址上的数进行翻转`*p ^= 0xffffffff;`，再检查结果是否正确，如果不正确则说明已经到了边界。
- 另外，也应该可以通过BIOS或者硬件接口等方式获取。

#### 要求三：实现`FirstFitAllocator`

- 具体代码在`src/memory/frame_allocator.rs`中，其中的`FirstFitAllocator`对应的`struct`即为要求实现，这里采用了$O(n^2)$的算法，不再赘述。
- 建议：
  - 测试有些看起来不太鲁棒，只是简单的靠hardcode来进行测试，感觉不是很规整（当然对于这样简单的算法，这样的测试大体上也可以判断正确与否）
  - 测试接口的函数命名等方面比较confusing，就实验要求中的“`SegmentTreeAllocator`替换为 `FirstFitAllocator`”来说，给人的印象是实现同样的接口`init`、`alloc`和`dealloc`，每次只是申请一个物理帧，但是测试给的却是多个帧的申请和释放，而且也没有对应的说明，测试代码中也没有具体的注释说明每个函数的功能（虽然可以理解内容，但是可能想编译原理Java框架或者网络原理路由器框架那样非常规整而且有详细的注释更对教学比较友好，比如写清楚我们要实现的`memory::alloc_frames`函数传入参数的意义和返回值意义），再比如有一处`ppn`写为了`pnn`。
  - 以上均为个人见解，我并不否定框架代码已经非常好了，但是我觉得真正注意到一些软件工程上教授的细节可以做到更好。