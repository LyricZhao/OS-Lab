## rCore-Lab-8 文件系统

> 赵成钢 计75班 2017011362

#### 要求一：阅读文档并确保之前实验中实现了`sys_fork`
该作业分支是从`lab-5`的分支 check out 出来的，保证了`sys_fork`的实现。

#### 要求二：实现管道

- 对于管道的传输，我并没有用对这种文件保存`offset`之类的属性，而是直接用了`VecDeque`，并用了一层`Mutex`封装，在文件里面直接进行引用即可。
- 要写入的一端，直接拿到锁之后对双端队列进行`push_back`即可。
- 要读取的一端，拿到锁之后`pop_front`即可。
- 思考题
  - 父进程还没写，子进程直接读怎么办？
    - 我这里的做法是直接`syscall`返回，返回读取成功的长度为0。
    - 不断调用`syscall`即可。
    - 这种方法可能不是很优美，一种更好的方式是在内核态对线程进行睡眠，不过我认为`sys_read`本身就应该返回成功或者失败的情况，一直等到成功也不是一个好主意，所以我采取的策略是在用户态一直循环调用。
  - 如何保证不会发生 race condition ？
    - 对`VecDeque`加一个`Mutex`封装即可。
  - 在实现中是否曾遇到死锁？如果是，你是如何解决它的？
    - 没有遇到死锁。
    - 我猜测死锁的情况是读取拿锁并等待（可能因为守卫锁的变量没有 drop），然后写操作想拿锁的时候就出现了死锁。
    - 我这里的实现是读取拿锁并读取，如果没有就直接释放锁。

